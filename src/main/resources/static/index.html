<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@5.0.0/bundles/stomp.umd.min.js"></script>
    <link rel="stylesheet" href="main.css">
</head>
<body>

<h2>PLEASE HELP ME</h2>
<button onclick="createGame()">CREATE NEW GAME!</button>
<button onclick="joinGame()">JOIN TO GAME!</button>

<h2>TWOJA PLANSZA</h2>
<div id="board" class="board"></div>

<script>

    const gameId=1234;

    //TWORZENIE KLIENTA STOMP
    const stompClient = new StompJs.Client({
        brokerURL: 'ws://localhost:8080/game',
        debug: (str) => { console.log(str); }
    });

    //POŁĄCZ KLIENTA STOMP
    stompClient.onConnect = (frame) => {
        console.log('Connected: ' + frame);

        stompClient.subscribe('/topic/boardUpdate', (message) =>{
            console.log("Subscribed topic: ", JSON.parse(message.body));
            const board = JSON.parse(message.body);
            drawBoard(board)
        });

        stompClient.subscribe('/topic/gameCreated', (message) =>{
            console.log("Game created: ", JSON.parse(message.body));
        });

        stompClient.subscribe('/topic/gameStarted', (message) =>{
            console.log("Game started: ", JSON.parse(message.body));
        });
    }

    //OBSŁUGA BŁĘDÓW
    stompClient.onStompError = (frame) => {
        console.error('STOMP ERROR', frame)
    }

    //ROZPOCZYNANIE POŁĄCZENIA
    stompClient.activate();

    //FUNKCJA DO WYSYŁANIA WIADOMOŚĆI DO SERWERA
    function createGame() {
        const player = "Agatka"; //todo: pobrać użytkownika z inputa
        stompClient.publish({
            destination: "/app/createGame",
            body: JSON.stringify(player)
        });
    }

    //FUNKCJA DO DOŁĄCZENIA DO GRY
    function joinGame(gameId, player) {
        stompClient.publish({
            destination: "/app/joinGame",
            body: JSON.stringify({gameId: gameId, player: player})
        });
    }

    //NAMALUJ TABLICE
    function drawBoard(board) {
        const boardDiv = document.getElementById("board");
        boardDiv.innerHTML = ""; //czysci stare elementy

        for (let row = 0; row < board.length; row++) {
            for (let col = 0; col < board[row].length; col++) {
                const cell = document.createElement("div");
                cell.classList.add("cell");

                switch (board[row][col]) {
                    case '-':
                        cell.classList.add("water");
                        break;
                    case 'O':
                        cell.classList.add("ship");
                        break;
                    case "X":
                        cell.classList.add("hit");
                        cell.innerText = "X";
                        break;
                    case "M":
                        cell.classList.add("miss");
                        cell.innerText = "•";
                        break;
                }
                boardDiv.appendChild(cell)
            }
        }
    }

</script>

</body>
</html>